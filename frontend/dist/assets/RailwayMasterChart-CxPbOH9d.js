import{r as u,j as e}from"./index-CfYVP3uU.js";function S(t){var r,n,a="";if(typeof t=="string"||typeof t=="number")a+=t;else if(typeof t=="object")if(Array.isArray(t)){var s=t.length;for(r=0;r<s;r++)t[r]&&(n=S(t[r]))&&(a&&(a+=" "),a+=n)}else for(n in t)t[n]&&(a&&(a+=" "),a+=n);return a}function D(){for(var t,r,n=0,a="",s=arguments.length;n<s;n++)(t=arguments[n])&&(r=S(t))&&(a&&(a+=" "),a+=r);return a}const I=[{id:1,name:"Bhusaval Jn",code:"BSL",km:0,category:"junction",notes:"Crew / Yard Control"},{id:2,name:"Varangaon",code:"VRJ",km:18,category:"block"},{id:3,name:"Bodwad",code:"BDWD",km:43,category:"block"},{id:4,name:"Raver",code:"RV",km:61,category:"crossing",notes:"Crossing loop"},{id:5,name:"Burhanpur",code:"BAU",km:74,category:"junction",notes:"Control Cabin"},{id:6,name:"Nepanagar",code:"NPNR",km:98,category:"crossing"},{id:7,name:"Chhanera",code:"CAER",km:121,category:"block"},{id:8,name:"Khandwa Jn",code:"KNW",km:132,category:"junction",notes:"Division Boundary"}],W=[{id:"BSL-VRJ",fromStationId:1,toStationId:2,name:"BSL - VRJ",lengthKm:18,remarks:"Double line"},{id:"VRJ-BDWD",fromStationId:2,toStationId:3,name:"VRJ - BDWD",lengthKm:25},{id:"BDWD-RV",fromStationId:3,toStationId:4,name:"BDWD - RV",lengthKm:18,remarks:"Automatic block"},{id:"RV-BAU",fromStationId:4,toStationId:5,name:"RV - BAU",lengthKm:13,remarks:"Neutral section"},{id:"BAU-NPNR",fromStationId:5,toStationId:6,name:"BAU - NPNR",lengthKm:24},{id:"NPNR-CAER",fromStationId:6,toStationId:7,name:"NPNR - CAER",lengthKm:23},{id:"CAER-KNW",fromStationId:7,toStationId:8,name:"CAER - KNW",lengthKm:11,remarks:"Approach controlled"}],B=[{id:"BSL-UP-H",stationId:1,direction:"up",type:"home"},{id:"BSL-UP-S",stationId:1,direction:"up",type:"starter"},{id:"BSL-DN-H",stationId:1,direction:"down",type:"home"},{id:"BSL-DN-S",stationId:1,direction:"down",type:"starter"},{id:"VRJ-UP-H",stationId:2,direction:"up",type:"home"},{id:"VRJ-UP-S",stationId:2,direction:"up",type:"starter"},{id:"VRJ-DN-H",stationId:2,direction:"down",type:"home"},{id:"VRJ-DN-S",stationId:2,direction:"down",type:"starter"},{id:"BDWD-UP-H",stationId:3,direction:"up",type:"home"},{id:"BDWD-DN-H",stationId:3,direction:"down",type:"home"},{id:"RV-UP-H",stationId:4,direction:"up",type:"home"},{id:"RV-UP-S",stationId:4,direction:"up",type:"starter"},{id:"RV-DN-H",stationId:4,direction:"down",type:"home"},{id:"RV-DN-S",stationId:4,direction:"down",type:"starter"},{id:"BAU-UP-H",stationId:5,direction:"up",type:"home"},{id:"BAU-UP-S",stationId:5,direction:"up",type:"starter"},{id:"BAU-DN-H",stationId:5,direction:"down",type:"home"},{id:"BAU-DN-S",stationId:5,direction:"down",type:"starter"},{id:"NPNR-UP-H",stationId:6,direction:"up",type:"home"},{id:"NPNR-DN-H",stationId:6,direction:"down",type:"home"},{id:"CAER-UP-H",stationId:7,direction:"up",type:"home"},{id:"CAER-DN-H",stationId:7,direction:"down",type:"home"},{id:"KNW-UP-H",stationId:8,direction:"up",type:"home"},{id:"KNW-UP-S",stationId:8,direction:"up",type:"starter"},{id:"KNW-DN-H",stationId:8,direction:"down",type:"home"},{id:"KNW-DN-S",stationId:8,direction:"down",type:"starter"}],w=[{id:1,number:"12812",name:"Amarkantak Express",type:"superfast",direction:"up",schedule:[{stationId:1,arrival:"04:10",departure:"04:10",remarks:"Right time start"},{stationId:2,arrival:"04:34",departure:"04:36"},{stationId:3,arrival:"05:05",departure:"05:07"},{stationId:4,arrival:"05:30",departure:"05:32"},{stationId:5,arrival:"06:03",departure:"06:06",crossingWith:"12811",remarks:"Loop line halt"},{stationId:6,arrival:"06:26",departure:"06:28"},{stationId:7,arrival:"07:00",departure:"07:02"},{stationId:8,arrival:"07:25",departure:"07:25",remarks:"Terminate at KNW"}]},{id:2,number:"22131",name:"Bhusaval Passenger",type:"passenger",direction:"up",schedule:[{stationId:1,arrival:"06:10",departure:"06:10"},{stationId:2,arrival:"06:36",departure:"06:38"},{stationId:3,arrival:"07:10",departure:"07:13"},{stationId:4,arrival:"07:45",departure:"07:50",remarks:"Crossing loop occupied"},{stationId:5,arrival:"08:25",departure:"08:35"},{stationId:6,arrival:"09:05",departure:"09:15"},{stationId:7,arrival:"09:55",departure:"10:00"},{stationId:8,arrival:"10:35",departure:"10:35"}]},{id:3,number:"GDS-61",name:"Up Goods Special",type:"goods",direction:"up",schedule:[{stationId:1,arrival:"09:45",departure:"09:45"},{stationId:2,arrival:"10:25",departure:"10:40"},{stationId:3,arrival:"11:25",departure:"11:55"},{stationId:4,arrival:"12:40",departure:"13:10"},{stationId:5,arrival:"14:00",departure:"14:30"},{stationId:6,arrival:"15:15",departure:"15:45",crossingWith:"GDS-62"},{stationId:7,arrival:"16:30",departure:"17:00"},{stationId:8,arrival:"17:35",departure:"17:35"}]},{id:4,number:"12811",name:"Amarkantak Express",type:"superfast",direction:"down",schedule:[{stationId:8,arrival:"05:05",departure:"05:05"},{stationId:7,arrival:"05:28",departure:"05:30"},{stationId:6,arrival:"05:58",departure:"06:00"},{stationId:5,arrival:"06:03",departure:"06:07",crossingWith:"12812"},{stationId:4,arrival:"06:58",departure:"07:00"},{stationId:3,arrival:"07:25",departure:"07:27"},{stationId:2,arrival:"07:55",departure:"07:57"},{stationId:1,arrival:"08:15",departure:"08:15",remarks:"Arrival into BSL yard"}]},{id:5,number:"22132",name:"Khandwa Passenger",type:"passenger",direction:"down",schedule:[{stationId:8,arrival:"09:45",departure:"09:45"},{stationId:7,arrival:"10:20",departure:"10:25"},{stationId:6,arrival:"10:55",departure:"11:05"},{stationId:5,arrival:"11:35",departure:"11:45"},{stationId:4,arrival:"12:15",departure:"12:22"},{stationId:3,arrival:"12:50",departure:"12:55"},{stationId:2,arrival:"13:20",departure:"13:25"},{stationId:1,arrival:"13:45",departure:"13:45"}]},{id:6,number:"GDS-62",name:"Down Goods Special",type:"goods",direction:"down",schedule:[{stationId:8,arrival:"11:10",departure:"11:10"},{stationId:7,arrival:"11:45",departure:"12:10"},{stationId:6,arrival:"12:45",departure:"13:15",crossingWith:"GDS-61"},{stationId:5,arrival:"14:00",departure:"14:30"},{stationId:4,arrival:"15:05",departure:"15:35"},{stationId:3,arrival:"16:10",departure:"16:40"},{stationId:2,arrival:"17:15",departure:"17:45"},{stationId:1,arrival:"18:20",departure:"18:20"}]}],b=3.25,$=110,o={top:60,right:80,bottom:80,left:120};function p(t){const[r,n]=t.split(":").map(Number);return r*60+n}function R(t){const r=Math.floor(t/60),n=t%60;return`${`${r}`.padStart(2,"0")}:${`${n}`.padStart(2,"0")}`}function M(t){return t.type==="goods"?{color:"#16a34a",dash:"8 5"}:t.direction==="down"?{color:"#2563eb"}:{color:"#dc2626"}}function L(t,r,n){const{color:a,dash:s}=M(t),i=[],d=[],x=[],m=[];t.schedule.forEach((l,y)=>{const h=r.get(l.stationId);if(h==null)return;const g=p(l.arrival),v=p(l.departure);l.crossingWith&&x.push({x:n(Math.round((g+v)/2)),y:h,with:l.crossingWith}),l.arrival!==l.departure&&i.push({x1:n(g),x2:n(v),y:h}),d.push({x:n(g),y:h,hollow:y===0}),y===0&&m.push({x:n(v),y:h});const j=t.schedule[y+1];if(!j)return;const k=r.get(j.stationId);if(k==null)return;const A=p(j.arrival);m.push({x:n(A),y:k})});const f=m.map((l,y)=>`${y===0?"M":"L"}${l.x},${l.y}`).join(" "),c=P(t.schedule,r,n,t.direction);return{train:t,path:f,color:a,dashArray:s,label:c,halts:i,arrivals:d,crossings:x}}function P(t,r,n,a){if(t.length===0)return{x:0,y:0};const s=t[0],i=t[1]??s,d=n(p(s.departure)),x=n(p(i.arrival)),m=r.get(s.stationId)??0,f=r.get(i.stationId)??m,c=(d+x)/2,l=(m+f)/2+(a==="up"?-26:26);return{x:c,y:l}}function U(){return new Map(I.map((t,r)=>{const n=o.top+r*$;return[t.id,n]}))}function C(){let t=Number.POSITIVE_INFINITY,r=Number.NEGATIVE_INFINITY;return w.forEach(n=>{n.schedule.forEach(a=>{const s=p(a.arrival),i=p(a.departure);t=Math.min(t,s,i),r=Math.max(r,s,i)})}),{min:Math.max(0,Math.floor((t-20)/5)*5),max:Math.ceil((r+20)/5)*5}}function H(t,r){const n=[],a=Math.floor(t/60)*60;for(let s=a;s<=r+60;s+=60)n.push(s);return n}const E={home:(t,r)=>`M${t-4},${r} A4,4 0 1,0 ${t+4},${r} A4,4 0 1,0 ${t-4},${r}`,starter:(t,r)=>`M${t-4},${r-4} L${t+4},${r-4} L${t+4},${r+4} L${t-4},${r+4} Z`,distant:(t,r)=>`M${t},${r-5} L${t+5},${r+5} L${t-5},${r+5} Z`},K={up:"#dc2626",down:"#2563eb"};function O({height:t=720,className:r}){const n=u.useMemo(()=>U(),[]),a=u.useMemo(()=>C(),[]),s=u.useMemo(()=>o.left+o.right+(a.max-a.min)*b,[a.max,a.min]),i=u.useMemo(()=>o.top+o.bottom+$*(I.length-1),[]),d=u.useMemo(()=>c=>o.left+(c-a.min)*b,[a.min]),x=u.useMemo(()=>w.map(c=>L(c,n,d)),[n,d]),m=u.useMemo(()=>H(a.min,a.max),[a.max,a.min]),f=typeof t=="number"?`${Math.max(t,i)}px`:t?String(t):`${i}px`;return e.jsxs("div",{className:D("w-full rounded-2xl border border-slate-200 bg-blue-50 shadow-sm",r),style:{height:f},children:[e.jsxs("div",{className:"flex flex-col gap-3 px-3 pt-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-slate-800",children:"मास्टर चार्ट (Master Chart)"}),e.jsx("p",{className:"text-sm text-slate-500",children:"Train control diagram — Bhusaval Jn (BSL) ⇄ Khandwa Jn (KNW)"})]}),e.jsx(T,{})]}),e.jsx("div",{className:"p-0 pt-0 h-full",children:e.jsx("div",{className:"relative overflow-x-auto h-full",children:e.jsxs("svg",{viewBox:`0 0 ${s} ${i}`,style:{width:"100%",height:"100%"},preserveAspectRatio:"xMinYMin meet",role:"img","aria-label":"Railway master chart showing train movements between Bhusaval and Khandwa",children:[e.jsx("rect",{x:0,y:0,width:s,height:i,fill:"#f8fafc",rx:18}),e.jsx(V,{chartWidth:s,chartHeight:i,timeTicks:m,timeToX:d,stationPositions:n}),e.jsx(F,{stationPositions:n}),e.jsx(J,{stationPositions:n,timeBounds:a}),e.jsx(G,{stationPositions:n}),x.map(c=>e.jsx(Y,{graphic:c},c.train.id))]})})}),e.jsx("div",{className:"px-3 pb-3 text-xs text-slate-500",children:"Horizontal ticks depict train halts. Arrows indicate direction of movement. Crossing symbols show planned meet-pass operations under station control."})]})}function V({chartWidth:t,chartHeight:r,timeTicks:n,timeToX:a,stationPositions:s}){return e.jsxs("g",{children:[n.map(i=>{const d=a(i);return e.jsxs("g",{children:[e.jsx("line",{x1:d,x2:d,y1:o.top-20,y2:r-o.bottom+20,stroke:"#cbd5f5",strokeWidth:1}),e.jsx("text",{x:d,y:r-o.bottom+60,textAnchor:"middle",className:"fill-slate-500 text-[12px]",fontFamily:"Inter, system-ui, sans-serif",children:R(i)})]},i)}),I.map(i=>{const d=s.get(i.id);return d==null?null:e.jsx("line",{x1:o.left-10,x2:t-o.right+20,y1:d,y2:d,stroke:"#d1d5db",strokeWidth:.8,strokeDasharray:"5 4"},`h-${i.id}`)})]})}function F({stationPositions:t}){return e.jsx("g",{children:I.map(r=>{const n=t.get(r.id);if(n==null)return null;const a=r.category==="crossing";return e.jsxs("g",{transform:`translate(0, ${n})`,children:[e.jsx("circle",{cx:o.left-40,cy:0,r:6,fill:"#0f172a"}),e.jsx("text",{x:o.left-55,y:-14,textAnchor:"end",className:"fill-slate-800 text-[13px] font-semibold tracking-wide",fontFamily:"Inter, system-ui, sans-serif",children:r.name}),e.jsxs("text",{x:o.left-55,y:4,textAnchor:"end",className:"fill-slate-500 text-[11px]",fontFamily:"Inter, system-ui, sans-serif",children:[r.code," • ",r.km," km"]}),r.notes?e.jsx("text",{x:o.left-55,y:20,textAnchor:"end",className:"fill-slate-400 text-[10px]",fontFamily:"Inter, system-ui, sans-serif",children:r.notes}):null,a?e.jsx("text",{x:o.left-12,y:5,className:"fill-amber-500 text-[11px]",fontFamily:"Inter, system-ui, sans-serif",children:"✶"}):null]},r.id)})})}function J({stationPositions:t,timeBounds:r}){const n=o.left-160;return e.jsxs("g",{children:[W.map(a=>{const s=t.get(a.fromStationId),i=t.get(a.toStationId);if(s==null||i==null)return null;const d=(s+i)/2;return e.jsxs("g",{children:[e.jsx("line",{x1:n+50,x2:n+50,y1:s,y2:i,stroke:"#9ca3af",strokeWidth:1.4,strokeDasharray:"3 3"}),e.jsx("text",{x:n,y:d-6,textAnchor:"start",className:"fill-slate-600 text-[11px] font-medium",fontFamily:"Inter, system-ui, sans-serif",children:a.name}),e.jsxs("text",{x:n,y:d+10,textAnchor:"start",className:"fill-slate-400 text-[10px]",fontFamily:"Inter, system-ui, sans-serif",children:[a.lengthKm," km ",a.remarks?`• ${a.remarks}`:""]})]},a.id)}),e.jsx("text",{x:o.left+(r.max-r.min)*b/2,y:o.top-80,textAnchor:"middle",className:"fill-slate-600 text-[13px] font-semibold uppercase tracking-[0.2em]",fontFamily:"Inter, system-ui, sans-serif",children:"Time ➝"})]})}function G({stationPositions:t}){return e.jsxs("g",{children:[B.map(r=>{const n=t.get(r.stationId);if(n==null)return null;const a=r.direction==="up"?-24:24,s=o.left-110+(r.direction==="up"?-10:10),i=E[r.type],d=K[r.direction];return e.jsx("path",{d:i?i(s,n+a):"",fill:r.type==="starter"?d:"none",stroke:d,strokeWidth:1.4,opacity:.9},r.id)}),e.jsx("text",{x:o.left-110,y:o.top-35,textAnchor:"middle",className:"fill-slate-500 text-[10px]",fontFamily:"Inter, system-ui, sans-serif",children:"Signals"}),e.jsx("line",{x1:o.left-140,x2:o.left-80,y1:o.top-28,y2:o.top-28,stroke:"#cbd5f5",strokeWidth:1})]})}function Y({graphic:t}){return e.jsxs("g",{children:[e.jsx("defs",{children:e.jsx("marker",{id:`arrow-${t.train.id}`,viewBox:"0 0 10 10",refX:"8",refY:"5",markerWidth:"8",markerHeight:"8",orient:"auto",children:e.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:t.color})})}),e.jsx("path",{d:t.path,fill:"none",stroke:t.color,strokeWidth:2.6,strokeDasharray:t.dashArray,markerEnd:`url(#arrow-${t.train.id})`}),t.halts.map((a,s)=>e.jsx("line",{x1:a.x1,x2:a.x2,y1:a.y,y2:a.y,stroke:t.color,strokeWidth:3,strokeLinecap:"round"},`${t.train.id}-halt-${s}`)),t.arrivals.map((a,s)=>e.jsx("circle",{cx:a.x,cy:a.y,r:a.hollow?4:5,fill:a.hollow?"#ffffff":t.color,stroke:t.color,strokeWidth:a.hollow?1.5:0},`${t.train.id}-arrival-${s}`)),t.crossings.map((a,s)=>e.jsxs("g",{transform:`translate(${a.x}, ${a.y})`,children:[e.jsx("line",{x1:-6,x2:6,y1:-6,y2:6,stroke:"#0f172a",strokeWidth:1.6}),e.jsx("line",{x1:-6,x2:6,y1:6,y2:-6,stroke:"#0f172a",strokeWidth:1.6}),e.jsxs("text",{x:0,y:-10,textAnchor:"middle",className:"fill-slate-600 text-[10px]",fontFamily:"Inter, system-ui, sans-serif",children:["X ",a.with]})]},`${t.train.id}-cross-${s}`)),e.jsxs("g",{transform:`translate(${t.label.x-150/2}, ${t.label.y-34/2})`,children:[e.jsx("rect",{width:150,height:34,rx:6,fill:"#f1f5f9",stroke:t.color,strokeWidth:1,opacity:.94}),e.jsxs("text",{x:12,y:16,className:"fill-slate-700 text-[11px] font-semibold",fontFamily:"Inter, system-ui, sans-serif",children:[t.train.number," • ",t.train.name]}),e.jsx("text",{x:12,y:28,className:"fill-slate-500 text-[10px]",fontFamily:"Inter, system-ui, sans-serif",children:t.train.direction==="up"?"Up (BSL → KNW)":"Down (KNW → BSL)"})]})]})}function T(){return e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs font-medium text-slate-600",children:[e.jsx(N,{color:"#dc2626",label:"Up Express / Passenger"}),e.jsx(N,{color:"#2563eb",label:"Down Express / Passenger"}),e.jsx(N,{color:"#16a34a",label:"Goods / Freight",dashed:!0}),e.jsx(_,{})]})}function N({color:t,label:r,dashed:n}){return e.jsxs("span",{className:"inline-flex items-center gap-2 rounded-full border border-slate-200 bg-slate-50 px-3 py-1",children:[e.jsx("span",{className:"inline-flex h-3 w-8 items-center justify-center",style:{backgroundColor:n?"transparent":t,backgroundImage:n?`repeating-linear-gradient(90deg, ${t}, ${t} 6px, transparent 6px, transparent 12px)`:void 0,border:n?`1px dashed ${t}`:`1px solid ${t}`,borderRadius:"9999px"}}),e.jsx("span",{children:r})]})}function _(){return e.jsxs("span",{className:"inline-flex items-center gap-4 rounded-full border border-slate-200 bg-slate-50 px-3 py-1",children:[e.jsxs("span",{className:"inline-flex items-center gap-1 text-slate-600",children:[e.jsx("span",{className:"inline-block h-3 w-3 border border-slate-600"}),e.jsx("span",{children:"Crossing"})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-slate-600",children:[e.jsx("span",{className:"inline-block h-[2px] w-6 bg-slate-600"}),e.jsx("span",{children:"Halt"})]}),e.jsxs("span",{className:"inline-flex items-center gap-1 text-slate-600",children:[e.jsx("span",{className:"inline-block text-[12px] leading-none text-amber-500",children:"✶"}),e.jsx("span",{children:"Crossing station"})]})]})}export{O as default};
